<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Computer Usage Invoice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-print-color-adjust: exact;
        }
        .invoice-box {
            max-width: 850px;
            margin: auto;
            padding: 2.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            font-size: 16px;
            line-height: 1.6;
            color: #374151;
            position: relative;
        }
        [contenteditable="true"] {
            transition: all 0.2s ease-in-out;
            padding: 2px 4px;
            border-radius: 4px;
        }
        [contenteditable="true"]:hover {
            outline: 2px dashed #9ca3af;
            background-color: #f9fafb;
        }
        [contenteditable="true"]:focus {
            outline: 2px solid #4f46e5;
            background-color: #f1f5f9;
        }
        .table-header {
            background-color: #f3f4f6;
            font-weight: 600;
            color: #1f2937;
        }
        .action-button {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .action-button:hover {
            transform: translateY(-1px);
        }
        .paid-stamp {
            position: absolute;
            top: 150px;
            right: 50px;
            color: #d1fae5;
            border: 8px solid #d1fae5;
            font-size: 4rem;
            font-weight: 700;
            text-transform: uppercase;
            transform: rotate(-15deg);
            opacity: 0.8;
            border-radius: 0.5rem;
            display: none; /* Hidden by default */
            z-index: 10;
        }
        .is-paid .paid-stamp {
            display: block;
        }
        .delete-row:hover {
            color: #ef4444;
            cursor: pointer;
        }
        @media print {
            body, .invoice-box {
                box-shadow: none;
                border: 0;
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none;
            }
            .paid-stamp {
                color: #10b981 !important;
                border-color: #10b981 !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <div class="invoice-box bg-white rounded-xl" id="invoice-container">
        <div class="paid-stamp">Paid</div>
        <!-- Header -->
        <header class="flex justify-between items-start pb-8 border-b border-gray-200">
            <div class="flex items-center gap-4">
                <div class="bg-gray-200 w-20 h-20 rounded-lg flex items-center justify-center cursor-pointer" id="logo-container" title="Click to upload logo">
                    <img id="logo-img" src="" alt="Logo" class="hidden h-full w-full object-contain">
                    <span id="logo-placeholder" class="text-gray-500 text-xs text-center">Your Logo</span>
                    <input type="file" id="logo-upload" class="hidden" accept="image/*">
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900" contenteditable="true">Your Company</h1>
                    <p contenteditable="true" class="text-sm">123 Your Street, Your City, ST 12345</p>
                    <p contenteditable="true" class="text-sm">your.email@example.com</p>
                </div>
            </div>
            <div class="text-right">
                <h2 class="text-4xl font-bold text-gray-800 tracking-tight">INVOICE</h2>
                <p class="mt-2">#<span contenteditable="true">123</span></p>
                <p>Date: <span contenteditable="true" id="invoice-date"></span></p>
                <p>Due Date: <span contenteditable="true" id="due-date"></span></p>
            </div>
        </header>

        <!-- Client Info -->
        <section class="flex justify-between mt-8">
            <div id="client-info">
                <h3 class="font-semibold text-gray-800">Bill To:</h3>
                <p contenteditable="true" id="client-company">Client Company Name</p>
                <p contenteditable="true" id="client-name">Client Name</p>
                <p contenteditable="true" id="client-address">456 Client Address, Client City, ST 67890</p>
                <p contenteditable="true" id="client-email">client.email@example.com</p>
            </div>
            <div class="text-right no-print">
                <label for="client-select" class="block text-sm font-medium text-gray-700">Saved Clients</label>
                <select id="client-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option>Select a client</option>
                </select>
                <div class="mt-2 flex gap-2 justify-end">
                    <button id="save-client" class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200">Save</button>
                    <button id="delete-client" class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200">Delete</button>
                </div>
            </div>
        </section>

        <!-- Invoice Items Table -->
        <section class="mt-10">
            <table class="w-full text-left" id="invoice-table">
                <thead>
                    <tr class="table-header">
                        <th class="p-3 rounded-l-lg">Description</th>
                        <th class="p-3 text-center w-24">Hours</th>
                        <th class="p-3 text-right w-32">Rate</th>
                        <th class="p-3 text-right w-32">Total</th>
                        <th class="p-3 text-center w-12 rounded-r-lg no-print"></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be added dynamically here -->
                </tbody>
            </table>
            <button id="add-row" class="mt-4 text-sm font-semibold text-indigo-600 hover:text-indigo-800 no-print flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                Add Item
            </button>
        </section>

        <!-- Totals -->
        <section class="flex justify-end mt-8">
            <div class="w-full max-w-sm">
                <div class="flex justify-between py-1">
                    <span>Subtotal:</span>
                    <span id="subtotal">$0.00</span>
                </div>
                <div class="flex justify-between items-center py-1">
                    <span>Tax (<span contenteditable="true" id="tax-rate">10</span>%):</span>
                    <span id="tax-amount">$0.00</span>
                </div>
                <div class="flex justify-between items-center mt-4 pt-4 border-t-2 border-gray-200">
                    <span class="font-bold text-lg text-gray-900">Total Due:</span>
                    <span class="font-bold text-lg text-gray-900" id="grand-total">$0.00</span>
                </div>
            </div>
        </section>

        <!-- Notes -->
        <section class="mt-12">
            <h4 class="font-semibold text-gray-800">Notes:</h4>
            <p class="text-sm text-gray-600" contenteditable="true" id="notes">
                Thank you for your business. Please make payment within 30 days.
            </p>
        </section>
        
        <!-- Action Buttons -->
        <footer class="mt-12 pt-8 border-t border-gray-200 text-center no-print">
            <div class="flex justify-center gap-4">
                <button id="import-btn" class="action-button bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 shadow-md">Import Data</button>
                <button id="export-btn" class="action-button bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 shadow-md">Export Data</button>
                <button id="paid-btn" class="action-button bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 shadow-md">Mark as Paid</button>
                <button onclick="window.print()" class="action-button bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 shadow-md">Print Invoice</button>
            </div>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Element References ---
        const invoiceTableBody = document.querySelector('#invoice-table tbody');
        const subtotalEl = document.getElementById('subtotal');
        const taxAmountEl = document.getElementById('tax-amount');
        const grandTotalEl = document.getElementById('grand-total');
        const taxRateEl = document.getElementById('tax-rate');
        const addRowButton = document.getElementById('add-row');
        const clientSelect = document.getElementById('client-select');
        const invoiceContainer = document.getElementById('invoice-container');

        // --- Initial State & Setup ---
        const state = {
            clients: {},
            invoiceItems: [
                { desc: 'Standard Computer Usage', hours: 8, rate: 50 },
                { desc: 'Software License Rental (Suite A)', hours: 1, rate: 150 },
                { desc: 'Data Processing & Analysis', hours: 5.5, rate: 75 }
            ]
        };

        // --- Core Functions ---
        const calculateRowTotal = (row) => {
            const hours = parseFloat(row.querySelector('.hours').textContent) || 0;
            const rate = parseFloat(row.querySelector('.rate').textContent) || 0;
            const total = hours * rate;
            row.querySelector('.total').textContent = '$' + total.toFixed(2);
            return total;
        };

        const calculateGrandTotal = () => {
            let subtotal = 0;
            invoiceTableBody.querySelectorAll('tr').forEach(row => {
                subtotal += calculateRowTotal(row);
            });

            const taxRate = parseFloat(taxRateEl.textContent) || 0;
            const taxAmount = subtotal * (taxRate / 100);

            subtotalEl.textContent = '$' + subtotal.toFixed(2);
            taxAmountEl.textContent = '$' + taxAmount.toFixed(2);
            grandTotalEl.textContent = '$' + (subtotal + taxAmount).toFixed(2);
        };

        const createInvoiceRow = (item) => {
            const newRow = document.createElement('tr');
            newRow.className = 'border-b border-gray-200';
            newRow.innerHTML = `
                <td class="p-3"><div contenteditable="true">${item.desc}</div></td>
                <td class="p-3 text-center"><div contenteditable="true" class="hours">${item.hours}</div></td>
                <td class="p-3 text-right">$<span contenteditable="true" class="rate">${item.rate.toFixed(2)}</span></td>
                <td class="p-3 text-right font-semibold total">$0.00</td>
                <td class="p-3 text-center no-print">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto text-gray-400 delete-row" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-4v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </td>
            `;
            invoiceTableBody.appendChild(newRow);
        };

        const renderInvoiceItems = () => {
            invoiceTableBody.innerHTML = '';
            state.invoiceItems.forEach(createInvoiceRow);
            calculateGrandTotal();
        };
        
        // --- Client Management ---
        const loadClients = () => {
            const savedClients = localStorage.getItem('invoiceClients');
            state.clients = savedClients ? JSON.parse(savedClients) : {};
            clientSelect.innerHTML = '<option>Select a client</option>';
            for (const clientName in state.clients) {
                const option = document.createElement('option');
                option.value = clientName;
                option.textContent = clientName;
                clientSelect.appendChild(option);
            }
        };

        const saveClient = () => {
            const clientName = document.getElementById('client-company').textContent.trim();
            if (!clientName) {
                alert('Please enter a client company name to save.');
                return;
            }
            state.clients[clientName] = {
                company: clientName,
                name: document.getElementById('client-name').textContent,
                address: document.getElementById('client-address').textContent,
                email: document.getElementById('client-email').textContent,
            };
            localStorage.setItem('invoiceClients', JSON.stringify(state.clients));
            loadClients();
            clientSelect.value = clientName;
            alert(`Client "${clientName}" saved!`);
        };

        const deleteClient = () => {
            const clientName = clientSelect.value;
            if (clientName && clientName !== 'Select a client') {
                if (confirm(`Are you sure you want to delete client "${clientName}"?`)) {
                    delete state.clients[clientName];
                    localStorage.setItem('invoiceClients', JSON.stringify(state.clients));
                    loadClients();
                }
            } else {
                alert('Please select a client to delete.');
            }
        };
        
        const selectClient = (e) => {
            const clientName = e.target.value;
            const client = state.clients[clientName];
            if (client) {
                document.getElementById('client-company').textContent = client.company;
                document.getElementById('client-name').textContent = client.name;
                document.getElementById('client-address').textContent = client.address;
                document.getElementById('client-email').textContent = client.email;
            }
        };

        // --- Data Import/Export ---
        const exportData = () => {
            const currentItems = [];
            invoiceTableBody.querySelectorAll('tr').forEach(row => {
                currentItems.push({
                    desc: row.cells[0].textContent,
                    hours: parseFloat(row.querySelector('.hours').textContent) || 0,
                    rate: parseFloat(row.querySelector('.rate').textContent) || 0,
                });
            });

            const dataToExport = {
                clientInfo: {
                    company: document.getElementById('client-company').textContent,
                    name: document.getElementById('client-name').textContent,
                    address: document.getElementById('client-address').textContent,
                    email: document.getElementById('client-email').textContent,
                },
                invoiceItems: currentItems,
                taxRate: document.getElementById('tax-rate').textContent,
                notes: document.getElementById('notes').textContent,
                isPaid: invoiceContainer.classList.contains('is-paid'),
                logo: document.getElementById('logo-img').src,
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `invoice-data-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        };

        const importData = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    // Populate client info
                    document.getElementById('client-company').textContent = data.clientInfo.company;
                    document.getElementById('client-name').textContent = data.clientInfo.name;
                    document.getElementById('client-address').textContent = data.clientInfo.address;
                    document.getElementById('client-email').textContent = data.clientInfo.email;
                    // Populate invoice items
                    state.invoiceItems = data.invoiceItems;
                    renderInvoiceItems();
                    // Populate other fields
                    document.getElementById('tax-rate').textContent = data.taxRate;
                    document.getElementById('notes').textContent = data.notes;
                    invoiceContainer.classList.toggle('is-paid', data.isPaid);
                    // Populate logo
                    if (data.logo) {
                         document.getElementById('logo-img').src = data.logo;
                         document.getElementById('logo-img').classList.remove('hidden');
                         document.getElementById('logo-placeholder').classList.add('hidden');
                    }
                    calculateGrandTotal();
                } catch (error) {
                    alert('Error parsing file. Please make sure it is a valid invoice data file.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        };
        
        // --- Logo Handling ---
        const handleLogoUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('logo-img').src = event.target.result;
                    document.getElementById('logo-img').classList.remove('hidden');
                    document.getElementById('logo-placeholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        // --- Event Listeners ---
        document.getElementById('save-client').addEventListener('click', saveClient);
        document.getElementById('delete-client').addEventListener('click', deleteClient);
        clientSelect.addEventListener('change', selectClient);
        
        document.getElementById('export-btn').addEventListener('click', exportData);
        document.getElementById('import-btn').addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,application/json';
            input.onchange = importData;
            input.click();
        });

        document.getElementById('logo-container').addEventListener('click', () => document.getElementById('logo-upload').click());
        document.getElementById('logo-upload').addEventListener('change', handleLogoUpload);

        document.getElementById('paid-btn').addEventListener('click', () => {
            invoiceContainer.classList.toggle('is-paid');
        });

        invoiceTableBody.addEventListener('input', (e) => {
            if (e.target.matches('.hours, .rate')) {
                calculateGrandTotal();
            }
        });
        taxRateEl.addEventListener('input', calculateGrandTotal);

        addRowButton.addEventListener('click', () => {
            createInvoiceRow({ desc: 'New Item', hours: 1, rate: 0 });
            calculateGrandTotal();
        });

        invoiceTableBody.addEventListener('click', (e) => {
            if (e.target.closest('.delete-row')) {
                e.target.closest('tr').remove();
                calculateGrandTotal();
            }
        });
        
        // --- Initialization ---
        const today = new Date();
        document.getElementById('invoice-date').textContent = today.toLocaleDateString();
        const dueDate = new Date();
        dueDate.setDate(today.getDate() + 30);
        document.getElementById('due-date').textContent = dueDate.toLocaleDateString();

        loadClients();
        renderInvoiceItems();
    });
    </script>
</body>
</html>
